<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Zaxro blog! | Zaxro Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://suyuying.github.io/img/githubLogoV1.svg"><meta data-rh="true" name="twitter:image" content="https://suyuying.github.io/img/githubLogoV1.svg"><meta data-rh="true" property="og:url" content="https://suyuying.github.io/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Zaxro blog! | Zaxro Blog"><meta data-rh="true" name="description" content="A blog for recording note of coding and daily life!"><meta data-rh="true" property="og:description" content="A blog for recording note of coding and daily life!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/githubLogoV1.svg"><link data-rh="true" rel="canonical" href="https://suyuying.github.io/blog"><link data-rh="true" rel="alternate" href="https://suyuying.github.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://suyuying.github.io/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://H9WLDZ1QEH-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zaxro Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zaxro Blog Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Zaxro Blog" href="/opensearch.xml">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&amp;display=swap"><link rel="stylesheet" href="/assets/css/styles.c4346dc4.css">
<link rel="preload" href="/assets/js/runtime~main.b6d9a641.js" as="script">
<link rel="preload" href="/assets/js/main.e4acdade.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/githubLogoV1.svg" alt="Zaxro" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/githubLogoV1.svg" alt="Zaxro" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Zaxro</b></a><a class="navbar__item navbar__link" href="/docs/intro">Code Note</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Daily Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/30/Others/modemVSigw">Do Internet gateways and modem need to be used together?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/3/29/Aws/aws-book-study-note">aws book study note</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/29/Zabbix/zabbix-monitor-log">Zabbix Sender monitor key word in log, and show data in grafana</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/25/Aws/aws-iam-setting">aws iam setting introduction</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/20/SEO/google-register">How to let google find my website?</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/30/Others/modemVSigw">Do Internet gateways and modem need to be used together?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-30T00:00:00.000Z" itemprop="datePublished">March 30, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="device-basic-introduction">Device basic introduction<a href="#device-basic-introduction" class="hash-link" aria-label="Direct link to Device basic introduction" title="Direct link to Device basic introduction">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internet-gateway">internet gateway<a href="#internet-gateway" class="hash-link" aria-label="Direct link to internet gateway" title="Direct link to internet gateway">​</a></h3><p>互聯網閘道器（Internet Gateway）是一種網路設備，用於連接位於本地網路（例如公司或家庭網路）內的設備與互聯網間的通訊，扮演網路中介，將本地網路封包轉到外網，再把外網封包轉回本地網路，所以需要有 router 功能</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modem">Modem<a href="#modem" class="hash-link" aria-label="Direct link to Modem" title="Direct link to Modem">​</a></h3><p>數據機(Moden)，主要功用是將數字訊號轉換成模擬訊號。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="數字訊號">數字訊號<a href="#數字訊號" class="hash-link" aria-label="Direct link to 數字訊號" title="Direct link to 數字訊號">​</a></h3><p>數字信號是一種離散的信號，它由一系列離散的數字或二進制碼表示。這些二進制碼只能取 0 或 1 的值。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模擬訊號">模擬訊號<a href="#模擬訊號" class="hash-link" aria-label="Direct link to 模擬訊號" title="Direct link to 模擬訊號">​</a></h3><p>模擬信號是一種連續的信號，它是由一個連續的波形表示的。模擬信號可以取無限個值，因為它們是基於物理量（如電壓、電流、聲音波形等）的連續變化。模擬信號常用於聲音和視頻等模擬設備中，如收音機、電視和手機等</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="do-internet-gateways-and-modems-need-to-be-used-together">Do Internet gateways and modems need to be used together?<a href="#do-internet-gateways-and-modems-need-to-be-used-together" class="hash-link" aria-label="Direct link to Do Internet gateways and modems need to be used together?" title="Direct link to Do Internet gateways and modems need to be used together?">​</a></h2><p>不一定，這依據情形而定。</p><ol><li>撥號: 需要將計算機的數字訊號轉成模擬訊號，並透過電話線傳遞訊號到互聯網。</li><li>電視網路: 同上，一些有線電視網路提供的網路服務一樣要先做訊號轉換，再透過有線電視網路傳輸。</li></ol><p>簡言之，如果你家使用撥接或有線電視提供的網路，就會需要數據機</p><p>如果你家用光纖、DSL、電纜等，就可以不用轉換訊號，直接透過 Igw 將數字訊號 routing 到外部網路。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/curl">curl</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/3/29/Aws/aws-book-study-note">aws book study note</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-29T00:00:00.000Z" itemprop="datePublished">March 29, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iam">IAM<a href="#iam" class="hash-link" aria-label="Direct link to IAM" title="Direct link to IAM">​</a></h2><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">基本權限流程</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">使用者</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AWS</span><span class="token plain">辨認身份</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">確認權限</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">授權操作</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>root 權限過大問題，透過設定不同權限帳號切割，在 aws 就是透過多個用戶群組切分權限，跟 linux 管理類似。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iam-組成">IAM 組成<a href="#iam-組成" class="hash-link" aria-label="Direct link to IAM 組成" title="Direct link to IAM 組成">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">法條-&gt;身份</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>透過法條規範身份。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="法條policy組成">法條(policy)組成<a href="#法條policy組成" class="hash-link" aria-label="Direct link to 法條(policy)組成" title="Direct link to 法條(policy)組成">​</a></h4><p>法條建立規則簡稱 EPCAR</p><p>Effect + Principal + Condition + Action + Resource
允許/拒絕 + 主體(IAM user,or <!-- -->*<!-- -->) + 啥條件(ip or MFA) + 執行動作 + 對哪項資源(s3,rds...)</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="身份組成">身份組成<a href="#身份組成" class="hash-link" aria-label="Direct link to 身份組成" title="Direct link to 身份組成">​</a></h4><p>主要有兩類</p><ol><li>授權 policy 的 group，跟依附在 group 底下有長期憑證的 IAM user。</li><li>使用短期 credential 的 IAM role，外部系統帳號（Federating Exist User. 例如: github action,google 登入)等，公司本地帳號，其他 aws 帳號，aws 資源間溝通，都可以透過連結的本 aws 帳號 IAM role 做資源操作。</li></ol><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>外部使用者跟本地 sso 驗證過程</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">客戶端應用程式:A-&gt; 你的Identity Provider(ldP)主機 ex google,github等-&gt; google,github等的LDAP database 驗證 -&gt; 回傳SAML驗證給客戶端A-&gt;A呼叫AWS STS(Security Token Service)驗證-&gt;AWS 回應暫時憑證-&gt;客戶端A透過憑證取到aws資源</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc">VPC<a href="#vpc" class="hash-link" aria-label="Direct link to VPC" title="Direct link to VPC">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">封包-&gt;IGW-&gt;Route Table -&gt;NACL-&gt;Public Subnet-&gt;Instance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws">AWS</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/29/Zabbix/zabbix-monitor-log">Zabbix Sender monitor key word in log, and show data in grafana</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-29T00:00:00.000Z" itemprop="datePublished">March 29, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前提">前提<a href="#前提" class="hash-link" aria-label="Direct link to 前提" title="Direct link to 前提">​</a></h2><p>這邊假設已經設定好 host，且 zabbix 有接上 grafana 情況後，繼續往下描述.</p><p>目的: 定時抓取某 log file 其中的特定關鍵字，用 zabbix-sender 傳送資訊給 zabbix server，並把資料設定報警到 telegram，資訊會用 grafana 的 log 顯示。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step1-設定-item">step1. 設定 item<a href="#step1-設定-item" class="hash-link" aria-label="Direct link to step1. 設定 item" title="Direct link to step1. 設定 item">​</a></h3><p>正常 zabbix 設定機器流程：</p><p>建立 Hosts groups-&gt; 建立 Templates-&gt;往 Template 內設定要監控的 item-&gt;再把 templates 連結到 Hosts Groups 上面-&gt;最後把主機也就是 Host 添加到指定的 Host groups 上面。</p><p>這邊因為特別需求關係(只有這一台機器需要），因此直接在該 Host 上面設定 item.</p><p>選 Hosts</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-side-bar-9ca4a1f3116d447b5a09cc577b209704.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>因為是用 zabbix-sender 所以這邊 type 用 zabbix trapper，要注意機器上面都用 Key 跟 zabbix server 溝通，Name 是該 Item 的名字，兩個設定常常會搞混。</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-traper-56b38395d4722bd7c7303d094a64a3e4.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step2-安裝-zabbix-sender-並傳資料">step2. 安裝 zabbix-sender 並傳資料<a href="#step2-安裝-zabbix-sender-並傳資料" class="hash-link" aria-label="Direct link to step2. 安裝 zabbix-sender 並傳資料" title="Direct link to step2. 安裝 zabbix-sender 並傳資料">​</a></h3><p>機器上腳本設定 zabbix_sender 傳送資料，用 key 跟 output 做傳送</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安裝zabbix-sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install zabbix-sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 傳資訊給zabbix server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zabbix_sender -z 10.121.0.9  -s yourHostName -k test -o &quot;$(cat /tmp/Lost_connection_to_db_server_${range2}_${range1}.log)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>確認 zabbix 是否有收到資料</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-get-last-data-4f5035c4cd89c0a5bd7642c9c12dd638.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step3-設定-grafana-抓取資料">step3. 設定 grafana 抓取資料<a href="#step3-設定-grafana-抓取資料" class="hash-link" aria-label="Direct link to step3. 設定 grafana 抓取資料" title="Direct link to step3. 設定 grafana 抓取資料">​</a></h3><p>確認有收到資料後，在 grafana 新建 panel</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/grafana-add-new-panel-bb60eccf47e80c7f2c2cbb02942536af.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>設定資料原，注意這邊的 Query Mode 是設定 Text，有很多種型態，選錯會找不到資料</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/grafana-set-data-source-861012de7e8c4fbf707311228a71155d.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>Grafana 模式記得要選 log，也可以使用其他模式玩玩看，因為這邊沒啥雷，就不特別截圖說明</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optionalstep4-zabbix-告警-tg">(optional)step4. zabbix 告警 tg<a href="#optionalstep4-zabbix-告警-tg" class="hash-link" aria-label="Direct link to (optional)step4. zabbix 告警 tg" title="Direct link to (optional)step4. zabbix 告警 tg">​</a></h3><p>先設定 Trigger，Problem expression 也就是當傳送資訊符合設定的條件就會引發告警，Recovery experssion 也就是當資訊符合哪些條件就會解除告警。</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-sender-b-log-12674fa7728409ba93f08ce3b314e90f.png" alt="zabbix-side-bar" class="img_CujE"></div><p>確定完的確會告警跟回復後，就可以設定 TG 告警。先去 Administration-&gt;Media type 複製 Telegram 那格。</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-clone-telegrana-2ff897d7d94a2c5fea128dda989a63dd.png" alt="zabbix-side-bar" class="img_CujE"></div><p>在 Token 位置加入你 TG Token</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-add-token-5636eb87fb7a7f27bdfe474efe54f31e.png" alt="zabbix-side-bar" class="img_CujE"></div><p>建立新 User Group</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-add-zabbix-group-27771fa730ca2f4fdd2f0095b5303ff0.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>設定該 User Group 對哪些 Host Group 有監控權限。</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-group-permission-fd95dfc4b5d7cc63e18161e07d5aa0da.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>建立 User，並把該 User 加到 Group 內部，並設定當哪些狀態發生就往 TG 送資料</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-user-media-7b08a9012605c23fa5347612a4d86c60.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div><p>以上都 OK，可以會到前面 media type 那邊測試是否可以傳資料到ＴＧ</p><p>如果要將 Trigger 的資料送到 TG，一定要設定 Actions，這邊是一個坑，前面設定完了但都沒有送到 TG，結果發現這格沒有設定ＺＺＺ</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/zabbix-trigger-actions-to-tg-25d1c6bc96907c6f46a5c985f47f6ce3.png" style="max-height:300px" alt="zabbix-side-bar" class="img_CujE"></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/zabbix">Zabbix</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/grafana">Grafana</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/25/Aws/aws-iam-setting">aws iam setting introduction</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-25T00:00:00.000Z" itemprop="datePublished">March 25, 2023</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-aws-iam">what is aws IAM<a href="#what-is-aws-iam" class="hash-link" aria-label="Direct link to what is aws IAM" title="Direct link to what is aws IAM">​</a></h2><p><a href="https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/service_code_examples.html" target="_blank" rel="noopener noreferrer">什麼是 IAM</a> aws 官網的資訊一般都寫得滿棒的，本文出處主要是參考官網資訊做整理，因為管理上經驗只限於自己的環境用的 s3,CI 等等，所以打算趁這個機會檢視之前設定的 iAM 有沒有問題，當然，我相信這只是過程，隨著看過的資訊跟事情越多，會得到不同或者多個答案，總之，就先從這一步開始吧！</p><p>AWS Identity and Access Management (IAM) 用途：安全地控制對 Amazon Web Services (AWS) 和帳戶資源的存取。使用 IAM 為使用者和角色等身分提供您的帳戶中資源的存取權。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws">AWS</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about aws iam setting introduction" href="/blog/2023/03/25/Aws/aws-iam-setting"><b>Read More</b></a></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/20/SEO/google-register">How to let google find my website?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-20T00:00:00.000Z" itemprop="datePublished">March 20, 2023</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="記錄一下整個-google-註冊自己網站過程">記錄一下整個 google 註冊自己網站過程<a href="#記錄一下整個-google-註冊自己網站過程" class="hash-link" aria-label="Direct link to 記錄一下整個 google 註冊自己網站過程" title="Direct link to 記錄一下整個 google 註冊自己網站過程">​</a></h2><ol><li>主要參考這篇 <a href="https://web-design.vip/google-web-submit.html" target="_blank" rel="noopener noreferrer">https://web-design.vip/google-web-submit.html</a> ， 他會提供你三個讓 google 爬蟲找到你最快得方式。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="讓你的網站加入搜尋功能">讓你的網站加入搜尋功能<a href="#讓你的網站加入搜尋功能" class="hash-link" aria-label="Direct link to 讓你的網站加入搜尋功能" title="Direct link to 讓你的網站加入搜尋功能">​</a></h2><ol><li><a href="https://docusaurus.io/docs/next/search" target="_blank" rel="noopener noreferrer">Using Algolia DocSearch</a>申請 Algolia 審查</li><li></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/google">google</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/16/Docker/docker-gitlab-error-connect-docker">docker gitlab runner error during connect Post &quot;http://docker:2375/v1.24/auth&quot; dial tcp lookup docker on 1.1.1.1:53 no such host</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-16T00:00:00.000Z" itemprop="datePublished">March 16, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="遇到問題的情境">遇到問題的情境<a href="#遇到問題的情境" class="hash-link" aria-label="Direct link to 遇到問題的情境" title="Direct link to 遇到問題的情境">​</a></h2><p>CICD 步驟裡面，每當開發人員把 code 寫完之後，會進行測試並把 code build 成 image 後推到 image registry
，之後到環境執行 deploy。</p><p>在 gitlab 裡面會用 gitlab runner，並在.gitlab-ci.yml 設計促發的情境下，執行.gitlab-ci.yml 內容，要在 gitlab runner 內 build image 通常會用到 docker:dind，它是具有 docker 引擎的 container！一般的 image 內通常都不會去安裝 docker 引擎，這段有點難懂，但你可以想想有 nginx,mysql 等等的 image，基本上只會有自己預設功能，不需要 docker 引擎，對於 docker 而言，裡面要可以用 docker 指令的， docker:dind 是一個選項。</p><p>在 build 版執行的 yml 如下。
主要功能就是登入在 gitlab 上面的公司的 image registry,之後在 gitlab runner 執行 build image 並推到 gitlab image registry.</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.gitlab-ci.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">stages</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">variables</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">IMAGE_NAME</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> hahaha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">CI_IMAGE</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token constant" style="color:#36acaa">CI_REGISTRY_IMAGE</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">$</span><span class="token constant" style="color:#36acaa">IMAGE_NAME</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">$</span><span class="token constant" style="color:#36acaa">CI_COMMIT_SHORT_SHA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># </span><span class="token maybe-class-name">Build</span><span class="token plain"> moni</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">moni</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">stage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">image</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> docker</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">tags</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">before_script</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> docker login </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u $</span><span class="token constant" style="color:#36acaa">CI_REGISTRY_USER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p $</span><span class="token constant" style="color:#36acaa">CI_REGISTRY_PASSWORD</span><span class="token plain"> $</span><span class="token constant" style="color:#36acaa">CI_REGISTRY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">script</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> docker build </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">t $</span><span class="token constant" style="color:#36acaa">CI_IMAGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> docker push $</span><span class="token constant" style="color:#36acaa">CI_IMAGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> docker rmi $</span><span class="token constant" style="color:#36acaa">CI_IMAGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">except</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> schedules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token constant" style="color:#36acaa">FROM</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">node</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">COPY</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">node </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">WORKDIR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">RUN</span><span class="token plain"> npm install</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">npm install gulp </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">gulp build</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">EXPOSE</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token constant" style="color:#36acaa">CMD</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;npm&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;start&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>執行過程到這一步<code>- docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</code>遇到報錯，
<code>error during connect: Post &quot;http://docker:2375/v1.24/auth&quot;: dial tcp: lookup docker on 1.1.1.1:53: no such host</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解法">解法:<a href="#解法" class="hash-link" aria-label="Direct link to 解法:" title="Direct link to 解法:">​</a></h3><p>在你掛到 gitlab runner 中 /etc/gitlab-runner 裡面的 config.toml，請先用 docker inspect 觀察 volume 掛載位置，如果你是用官網 local volume 掛載方法，那就是在 VM 上去 vim /srv/gitlab-runner/config/config.toml，去修改
<code>volumes = [&quot;/cache&quot;]</code> 變成
<code>volumes = [&quot;/var/run/docker.sock:/var/run/docker.sock&quot;,&quot;/cache&quot;]</code>。</p><p>並執行<code>docker restart gitlab-runner</code>!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="可能原因">可能原因：<a href="#可能原因" class="hash-link" aria-label="Direct link to 可能原因：" title="Direct link to 可能原因：">​</a></h3><p>執行這個修改，volumes 改為 <!-- -->[&quot;/var/run/docker.sock:/var/run/docker.sock&quot;, &quot;/cache&quot;]<!-- -->，讓 Runner Executor 使用主機外部的 Docker Engine。</p><p>所以推測，這可能是 gitlab runner 跟 gitlab server 上面驗證的機制，如果沒有這樣加，dind 就找不到 gitlab server 的驗證那關，所以就會失敗</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">docker</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/16/github-action/githubaction-env-secrets-variablr-config">environment variable and  secrets variable config in github</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-16T00:00:00.000Z" itemprop="datePublished">March 16, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-區分-env-設定模式">workflow 區分 env 設定模式<a href="#workflow-區分-env-設定模式" class="hash-link" aria-label="Direct link to workflow 區分 env 設定模式" title="Direct link to workflow 區分 env 設定模式">​</a></h2><p>使用 CI 跟寫程式都會遇到要從 env 拿取變數值的時候，在 github 管理方式如下，主要判斷是這個變數是否要給多個 workflow 使用。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="單-workflow-使用">單 workflow 使用<a href="#單-workflow-使用" class="hash-link" aria-label="Direct link to 單 workflow 使用" title="Direct link to 單 workflow 使用">​</a></h3><p>非密碼類型，在 workflow 中定義 env 即可。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name: Greeting on variable day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflow_dispatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DAY_OF_WEEK: Monday</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  greeting_job:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Greeting: Hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: &quot;Say Hello Mona it&#x27;s Monday&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run: echo &quot;$Greeting $First_Name. Today is $DAY_OF_WEEK!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          First_Name: Mona</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不同層次的環境變數可以繼承並覆蓋較高層次的環境變數。例如，如果您在頂級工作流程文件中設置了一個環境變數，並且在作業中使用相同的變數名稱定義了另一個值，那麼在該作業中使用的值將覆蓋頂級值。</p><p>密碼類型，就需要用到會跨多個 workflow 的 secrets 去管理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多-workflow-使用">多 workflow 使用<a href="#多-workflow-使用" class="hash-link" aria-label="Direct link to 多 workflow 使用" title="Direct link to 多 workflow 使用">​</a></h3><p>需在 github UI 設定變數。這些變數可以跨多個工作流程使用。
位置</p><div style="display:flex;justify-content:center"><img loading="lazy" src="/assets/images/github-env-repo-variable-18c0308cd7664714c41cd456ccba373e.png" alt="github-env-repo-variable.png" class="img_CujE"></div><p>主要三層級:</p><ol><li><p>組織</p></li><li><p>存儲庫</p></li><li><p>環境</p><p>上面圖有 repo 跟 env 的，使用順序部分：Environment &gt; Repository &gt; Organization。
如果有相同變數，優先用 Environment , than Repository, than：Organization。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用情境">使用情境<a href="#使用情境" class="hash-link" aria-label="Direct link to 使用情境" title="Direct link to 使用情境">​</a></h2><p>這邊提供參考</p><p>如果您不確定，也可以從存儲庫密鑰開始為所有東西創建密鑰。如果之後有引入需要不同密鑰的不同環境，例如 prod,dev,test 等，則可以將存儲庫密鑰移動到特定環境。然後在特定環境用特定變數值。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用方法">使用方法<a href="#使用方法" class="hash-link" aria-label="Direct link to 使用方法" title="Direct link to 使用方法">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="設定在-sercrets">設定在 sercrets<a href="#設定在-sercrets" class="hash-link" aria-label="Direct link to 設定在 sercrets" title="Direct link to 設定在 sercrets">​</a></h3><p>要用要這樣用<code>${{ secrets.YOURKEY }}</code>
為啥格式長這樣要看<a href="https://docs.github.com/en/actions/learn-github-actions/contexts#secrets-context" target="_blank" rel="noopener noreferrer">secrets 上下文</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="設定在-variables">設定在 variables<a href="#設定在-variables" class="hash-link" aria-label="Direct link to 設定在 variables" title="Direct link to 設定在 variables">​</a></h3><p>要用要這樣用<code>${{ vars.YOURKEY }}</code>
為啥格式長這樣要看<a href="https://docs.github.com/en/actions/learn-github-actions/contexts#vars-context" target="_blank" rel="noopener noreferrer">vars 上下文</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="設定在-workflow-裡的-env">設定在 workflow 裡的 env<a href="#設定在-workflow-裡的-env" class="hash-link" aria-label="Direct link to 設定在 workflow 裡的 env" title="Direct link to 設定在 workflow 裡的 env">​</a></h3><p>如果是在機器底下，可以用<code>$KEY</code>(linux).</p><p>設定在機器外面(job 以上層級)要用<a href="https://docs.github.com/en/actions/learn-github-actions/contexts#env-context" target="_blank" rel="noopener noreferrer">env 上下文</a>，<code>${{ env.mascot }}</code></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><a href="https://docs.github.com/en/actions/learn-github-actions/variables" target="_blank" rel="noopener noreferrer">參考的官網資料-variables 管理</a></p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/github-action">github action</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cicd">CICD</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/16/linux-server/little-curl-problem">A small issue with curl related to using different versions of curl between IDE and local terminal</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-16T00:00:00.000Z" itemprop="datePublished">March 16, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="同-pc-的-curl-結果不同">同 pc 的 curl 結果不同<a href="#同-pc-的-curl-結果不同" class="hash-link" aria-label="Direct link to 同 pc 的 curl 結果不同" title="Direct link to 同 pc 的 curl 結果不同">​</a></h2><p>前陣子因為需要檢查域名設定，測試過程中發現在 pycharm 運行 curl 指令，運行結果跟 iterm2 的運行結果不同，以下是 demo 指令</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -XPOST &#x27;https://www.boce.com/apiHtml/login&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -A &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;email_or_phone&quot;:&quot;thisIsSecret&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;password&quot;:&quot;thisIsSecret&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="curl-指令基本介紹">curl 指令基本介紹<a href="#curl-指令基本介紹" class="hash-link" aria-label="Direct link to curl 指令基本介紹" title="Direct link to curl 指令基本介紹">​</a></h2><p>Curl 是一種在命令列介面下使用的開放原始碼檔案傳輸工具，常用於 HTTP、HTTPS、FTP 等協定的傳輸
因為<code>curl</code>選項太多，可以用<code>curl --help all</code>看所有選項，
常用選項有以下</p><ol><li>-H 帶 header</li><li>-A 帶 useragent</li><li>-i 看回應 header(可以拿來查回應 token)</li><li>-d 使用 post 方法要帶入 data</li><li>-X 使用的方法 ex. POST PUT DELETE GET</li><li>-c cookie 相關操作
以下為例，登入網站並把回應 cookie 存在 cookie.txt</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -c cookie.txt -XPOST &#x27;https://www.boce.com/apiHtml/login&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -A &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;Content-Type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;email_or_phone&quot;:&quot;thisIsSecret&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;password&quot;:&quot;thisIsSecret&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>後續可以用<code>curl -b cookie.txt</code>在請求時把 cookie 帶入到 request 中</p><ol start="7"><li>-v 詳細模式</li><li><code>-o file名稱 網址</code> 下載圖片使用，檔名自己命名 Write to file instead of stdout</li><li><code>-O 網址</code> 下載資料使用，檔名同遠端網址檔名 Write output to a file named as the remote file</li><li>-L 跟隨 301 302 跳轉</li><li>Basic Authentication，可以攜帶 --user username:password 來通過驗證。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step1-問題排查-curl--v-看過程">step1. 問題排查 curl -v 看過程<a href="#step1-問題排查-curl--v-看過程" class="hash-link" aria-label="Direct link to step1. 問題排查 curl -v 看過程" title="Direct link to step1. 問題排查 curl -v 看過程">​</a></h3><p>比較後發現，ide 跟 terminal 帶的 header 跟 useragent 這些都有帶，問題不在這邊。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step2-檢查使用的-curl-是否有差">step2. 檢查使用的 curl 是否有差<a href="#step2-檢查使用的-curl-是否有差" class="hash-link" aria-label="Direct link to step2. 檢查使用的 curl 是否有差" title="Direct link to step2. 檢查使用的 curl 是否有差">​</a></h3><p>檢查<code>which crul</code>輸出</p><p>ide: /usr/bin/curl (curl 7.79.1 (x86_64-apple-darwin21.0) libcurl/7.79.1 (SecureTransport) LibreSSL/3.3.6 zlib/1.2.11 nghttp2/1.45.1
Release-Date: 2021-09-22)</p><p>terminal: /Users/ford/opt/anaconda3/bin/curl (curl 7.82.0 (x86_64-apple-darwin13.4.0) libcurl/7.82.0 OpenSSL/1.1.1n zlib/1.2.12 libssh2/1.10.0 nghttp2/1.46.0
Release-Date: 2022-03-05)</p><p>發現有差別，進一步檢查發現兩者檔案 size 也有差，使用的相關套件也有差。</p><p>解法： 直接指定 curl 位置,/usr/bin/curl 。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="心得">心得<a href="#心得" class="hash-link" aria-label="Direct link to 心得" title="Direct link to 心得">​</a></h2><p>基本上連自己電腦環境都可能用髒了，之後排查類似的 bug 順序會先檢查彼此使用指令的版本，確認沒差太多，在開始往其他方向排查。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/curl">curl</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/15/Aws/s3-setting-for-ci">s3 set iam permissions for Github Actions to achieve CIBuild an AWS s3 static website</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-15T00:00:00.000Z" itemprop="datePublished">March 15, 2023</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="s3-靜態網站設定">S3 靜態網站設定<a href="#s3-靜態網站設定" class="hash-link" aria-label="Direct link to S3 靜態網站設定" title="Direct link to S3 靜態網站設定">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>如果有打算限制能近來的域名，就請不要用靜態網站，就用預設的 RestApi 模式，接 cloudfront 透過 header 去限定。</p></div></div><p><a href="https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/HostingWebsiteOnS3Setup.html" target="_blank" rel="noopener noreferrer">官網教學很詳細！</a>
要在 Amazon S3 上設定靜態網站，如果是使用 UI 的話，請按照以下步驟進行操作：</p><ol><li>UI: 建立新的 S3 Bucket 或選擇一個現有的 Bucket。(Cli:<code>aws s3 mb s3://me-profile --profile ford --region us-west-1</code> 在 us-west-1 建立 s3 bucket,bucket 名稱是 me-profile,使用的 user 是 ford)</li><li>UI:在 Bucket 屬性中啟用靜態網站主機。</li><li>UI:指定要使用的索引文件(index.html)和錯誤文件。(Cli:<code>aws s3 website s3://bucket-name --index-document index.html --error-document error.html</code>)</li><li>UI :將必要的文件添加到 Bucket 中。(可以用 也可以用 cli
Cli:<code>aws s3 sync ./dist/ s3://fordserver-front --delete --profile ford</code>)</li><li>UI :配置 Bucket 策略以允許公開訪問文件，預設會全擋。</li><li>UI :新增儲存貯體政策，將儲存貯體內容設為可供大眾讀取，把這個 json 複製貼上</li></ol><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Sid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PublicReadGetObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:GetObject&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;arn:aws:s3:::Bucket-Name/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Resource 更新為您的儲存貯體名稱!</p><ol start="7"><li>(可選)如果要配置自己買的域名， 把 cname 設置以指向 S3 網站端點。</li></ol><p>按照這些步驟，您可以使用 Amazon S3 建立簡單且具成本效益的靜態網站。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="接-clourfront">接 clourfront<a href="#接-clourfront" class="hash-link" aria-label="Direct link to 接 clourfront" title="Direct link to 接 clourfront">​</a></h2><p>建立一個靜態網站之後，去建立 cloudfront，把流量導到 s3。</p><p>以下是建立 CloudFront 分發的步驟：</p><ol><li>登入 AWS Management Console 並前往 CloudFront 控制台頁面。</li><li>點擊「建立 distribution」按鈕。</li><li>在「建立 distribution」頁面中，您可以從下拉式清單選擇「Web」或「RTMP」分發的類型。</li><li>對於 Web 分發，在 Origin 欄位中，從下拉式清單選擇您的 S3 桶的 REST API 端點或輸入您的 S3 桶的網站端點。<a href="https://docs.aws.amazon.com/zh_tw/AmazonS3/latest/userguide/WebsiteEndpoints.html#WebsiteRestEndpointDiff" target="_blank" rel="noopener noreferrer">網站端點和 REST API 端點之間的主要差異</a></li><li>在預設快取行為中，為 Viewer 協議原則選擇 HTTP 和 HTTPS 或重新導向 HTTP 到 HTTPS。
注意：選擇僅使用 HTTPS 會封鎖所有 HTTP 請求。</li><li>如果您沒有使用 CloudFront 的替代域名 (CNAME)，則選擇「建立分發」以完成流程。如果您正在使用 CNAME，則在創建分發之前請按照以下額外步驟進行操作：<ul><li>對於替代域名 (CNAME)，請選擇「新增項目」，然後輸入您的替代域名。</li><li>對於自訂 SSL 憑證，從下拉式清單中選擇涵蓋您的 CNAME 的自訂 SSL 憑證，以將其指派給分發。(這裡可以用 aws 的自簽憑證會很方便!)</li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-provide-ci-access-to-write-to-s3-resources">lab: Provide CI access to write to S3 resources<a href="#lab-provide-ci-access-to-write-to-s3-resources" class="hash-link" aria-label="Direct link to lab: Provide CI access to write to S3 resources" title="Direct link to lab: Provide CI access to write to S3 resources">​</a></h2><p>目標: 設定 github action 在 code 更新以後會把 build 好的資料由 build 資料夾底下東西發到 S3.</p><p>名詞定義：</p><p>STS: AWS Security Token Service API,提供信任的使用者暫時安全憑證，控制對於 AWS 資源的存取。</p><p>OIDC: OpenID Connect,Google 或 Salesforce。如果想要在 OIDC 相容的 IdP 和您的 AWS 帳戶 之間建立信任，請使用 IAM OIDC 身分提供者。</p><p>IdP: Identity Provider 身分識別資訊提供者</p><p>SAML: Security Assertion Markup Language（安全斷言標記式語言）的縮寫，是指在身分識別資訊提供者（IdP）與服務提供者（Service Provider，SP）之間傳送驗證以及授權資料的一種公開標準。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lab-1用-iam-role-配合-odic-執行-ci">lab 1.用 IAM role 配合 ODIC 執行 CI<a href="#lab-1用-iam-role-配合-odic-執行-ci" class="hash-link" aria-label="Direct link to lab 1.用 IAM role 配合 ODIC 執行 CI" title="Direct link to lab 1.用 IAM role 配合 ODIC 執行 CI">​</a></h3><p>這邊示範用 ODIC，讓 aws 認可的 IdP 作身份驗證並連線到 AWS 存取並更新 S3.</p><p>在建立 IAM OIDC 身分提供者之後，必須建立一個或多個 IAM 角色。角色是 AWS 中的一個身分，並不擁有自己的憑證 (與 IAM 使用者不同)。在此情況中，角色以動態指派給聯合身分使用者，而該使用者由您組織的身分提供者 (IdP) 進行驗證。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">順序:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">建立Identity Providers-&gt;建立角色-&gt;自訂信任政策-&gt;連結許可政策-&gt;複製建立的角色ARN-&gt;設定github CI/CD的secret-&gt;建立yml檔</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="建立-identity-providers">建立 Identity Providers<a href="#建立-identity-providers" class="hash-link" aria-label="Direct link to 建立 Identity Providers" title="Direct link to 建立 Identity Providers">​</a></h4><ol><li>AWS console 查詢 IAM，左方 nav 欄位選供應商類型後, 選 OpenID Connect.</li><li>供應商 URL, 輸入 <a href="https://token.actions.githubusercontent.com" target="_blank" rel="noopener noreferrer">https://token.actions.githubusercontent.com</a></li><li>按&quot;取得指紋&quot;</li><li>對象, 輸入 sts.amazonaws.com
以上建立之後，arn:aws:iam::930209118237:oidc-provider/token.actions.githubusercontent.com</li><li>把 ARN 複製準備建立 role.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="建立角色">建立角色<a href="#建立角色" class="hash-link" aria-label="Direct link to 建立角色" title="Direct link to 建立角色">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">自訂信任政策-&gt;連結許可</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>授權 聯合使用者主體，給 github repo 是 USERNAME/YOUR_REPO 的 pull or main 可以用此角色，以下記得替換成你的 repo 名稱歐！</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">信任政策(關係)</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Principal&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;Federated&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;arn:aws:iam::9302XXX18237:oidc-provider/token.actions.githubusercontent.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts:AssumeRoleWithWebIdentity&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;StringEquals&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-property property" style="color:#36acaa">&quot;token.actions.githubusercontent.com:sub&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;repo:USERNAME/YOUR_REPO:pull_request&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;repo:USERNAME/YOUR_REPO:ref:refs/heads/main&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string-property property" style="color:#36acaa">&quot;token.actions.githubusercontent.com:aud&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sts.amazonaws.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因為 S3 許可設定真的太多了，這邊主要就勾選 list 跟幾個會用到的 delete/get/put object，許可設定參考<a href="https://docs.github.com/zh/enterprise-server@3.8/admin/github-actions/enabling-github-actions-for-github-enterprise-server/enabling-github-actions-with-amazon-s3-storage#%E4%BD%BF%E7%94%A8%E8%AE%BF%E9%97%AE%E5%AF%86%E9%92%A5%E9%80%9A%E8%BF%87-amazon-s3-%E5%AD%98%E5%82%A8%E5%90%AF%E7%94%A8-github-actions" target="_blank" rel="noopener noreferrer">官網這篇</a>。在看許可過程中有看到 AWS cloudtrail 提供的 IAM 紀錄解析，幫你分析之前的操作並用最小權限去設定(這個情境官網有舉例: 開發時可能會把權限全開，但實際上 PROD 環境就要限制權限，可以透過 cloudtrail 去分析之前所有對 S3 操作有用到的權限，並設定之)，但因為還沒實作，所以就先這樣。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">許可政策for S3 CI/CD</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Sid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VisualEditor0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:PutObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:GetObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:ListBucketMultipartUploads&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:ListMultipartUploadParts&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:AbortMultipartUpload&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:DeleteObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:ListBucket&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>github 設定檔，以下會執行 build，驗證 aws,把編譯後資料推到 s3。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>permissions 一定要設定成 write，這樣設定是要設寫入權限才能請求 OpenID Connect JWT 令牌。沒設定就會跑出以下報錯
Error: Credentials could not be loaded, please check your action inputs: Could not load credentials from any providers</p></div></div><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">.github/workflows/deploy.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Deploy</span><span class="token plain"> to </span><span class="token maybe-class-name">GitHub</span><span class="token plain"> </span><span class="token maybe-class-name">Pages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">on</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">push</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">branches</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # </span><span class="token maybe-class-name">Review</span><span class="token plain"> gh actions docs </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> you want to further define triggers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> paths</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # https</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">docs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">github</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">com</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">en</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">actions</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">using</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">workflows</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">workflow</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">syntax</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">github</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">actions#on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">permissions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  id</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">token</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">jobs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">deploy</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Deploy</span><span class="token plain"> to </span><span class="token maybe-class-name">GitHub</span><span class="token plain"> </span><span class="token maybe-class-name">Pages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runs</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">on</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">steps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> uses</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> actions</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> uses</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> actions</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">setup</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">node@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          node</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">version</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">cache</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> yarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Install</span><span class="token plain"> dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">run</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> yarn install </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">frozen</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lockfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Build</span><span class="token plain"> website</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">run</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> yarn build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Configure</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">AWS</span><span class="token plain"> </span><span class="token maybe-class-name">Credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">uses</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> aws</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">actions</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">configure</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">aws</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">credentials@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          aws</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">region</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ap</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">northeast</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          role</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">to</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">assume</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">PROD_DEPLOY_ROLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          role</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">session</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">OIDCSession</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Deploy</span><span class="token plain"> to </span><span class="token constant" style="color:#36acaa">S3</span><span class="token plain"> bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">run</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> aws s3 sync </span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">build</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> s3</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">yours3 </span><span class="token operator" style="color:#393A34">--</span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>參考資訊</p><ol><li><p><a href="https://docs.github.com/zh/enterprise-server@3.8/admin/github-actions/enabling-github-actions-for-github-enterprise-server/enabling-github-actions-with-amazon-s3-storage" target="_blank" rel="noopener noreferrer">Enabling GitHub Actions with Amazon S3 storage</a></p></li><li><p><a href="https://www.eliasbrange.dev/posts/secure-aws-deploys-from-github-actions-with-oidc/#2-add-github-as-an-identity-provider" target="_blank" rel="noopener noreferrer">Secure AWS deploys from GitHub Actions with OIDC</a></p></li></ol></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws">AWS</a></li></ul></div></footer></article><div id="disqus_thread"></div><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2023/03/11/github-action/githib-action-CI-to-github-container">CI:use github action to build image and push to git hub container registry</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-11T00:00:00.000Z" itemprop="datePublished">March 11, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/suyuying.png" alt="zaxro"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">zaxro</span></a></div><small class="avatar__subtitle" itemprop="description">Life is too short to live someone else&#x27;s dream</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-code-registry">Build code registry<a href="#build-code-registry" class="hash-link" aria-label="Direct link to Build code registry" title="Direct link to Build code registry">​</a></h2><p>把 code 推到 github 教學很多，可以 google 一下，不過要注意的是現在推 code 都要先在官網申請 token，新手很容易卡在這。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ways-to-build-image-and-push">ways to build image and push<a href="#ways-to-build-image-and-push" class="hash-link" aria-label="Direct link to ways to build image and push" title="Direct link to ways to build image and push">​</a></h2><p>執行 CI 前，要確認有 Dockerfile 並且在地端可以 docker run 服務起來，CI 過程會用該 Dokcerfile 產生 image。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="way1-build-image-and-push-from-local-side-by-docker-commanduse-ci-after-to-renew">way1. build image and push from local side by docker command,use CI after to renew<a href="#way1-build-image-and-push-from-local-side-by-docker-commanduse-ci-after-to-renew" class="hash-link" aria-label="Direct link to way1. build image and push from local side by docker command,use CI after to renew" title="Direct link to way1. build image and push from local side by docker command,use CI after to renew">​</a></h3><ol><li><p>在地端 build 完，然後推到 github container registry(需要用 github ui 建立 token,並給 token)
，然後把 token 存到 txt 檔</p></li><li><p>用 token 登入 github</p></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat token.txt | docker login ghcr.io -u suyuying --password-stdin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>-u</code> 換成自己的 username</p><p><code>token.txt</code>把 token 放在裡面</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/github-action">github action</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cicd">CICD</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about CI:use github action to build image and push to git hub container registry" href="/blog/2023/03/11/github-action/githib-action-CI-to-github-container"><b>Read More</b></a></div></footer></article><div id="disqus_thread"></div><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/2"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="font-sans container-fluid bg-gray-900 text-stone-200 pt-6 footer--dark"><div style="transform:translateX(-100%)" class="fixed bottom-0 left-0 h-1 w-full bg-indigo-600 backdrop-blur-3xl transition-transform duration-300 text-right text-white text-sm"></div><div class="container container-fluid"><div class="row footer__links mb-0"><div class="flex flex-wrap flex-col mb-2 w-1/3 items-baseline"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="flex flex-wrap flex-col mb-2 w-1/3 items-baseline"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="flex flex-wrap flex-col mb-2 w-1/3 items-baseline"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/suyuying" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b6d9a641.js"></script>
<script src="/assets/js/main.e4acdade.js"></script>
</body>
</html>
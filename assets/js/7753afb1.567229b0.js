"use strict";(self.webpackChunkwebsitev_1=self.webpackChunkwebsitev_1||[]).push([[2208],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>g});var l=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,l,n=function(e,t){if(null==e)return{};var a,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=l.createContext({}),u=function(e){var t=l.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=u(e.components);return l.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},d=l.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(a),d=n,g=c["".concat(s,".").concat(d)]||c[d]||m[d]||r;return a?l.createElement(g,i(i({ref:t},p),{},{components:a})):l.createElement(g,i({ref:t},p))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,i=new Array(r);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:n,i[1]=o;for(var u=2;u<r;u++)i[u]=a[u];return l.createElement.apply(null,i)}return l.createElement.apply(null,a)}d.displayName="MDXCreateElement"},24329:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var l=a(87462),n=(a(67294),a(3905));const r={title:"ELK KQL\u8a9e\u6cd5\u4ecb\u7d39",description:"Elastic\u67e5\u8a62\u662f\u900f\u904e\u67d0\u500bdata view\u53bb\u67e5\u5e95\u4e0b\u7684field,\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u65e5\u8a8c(data view)\u5c31\u50cf\u4e00\u5f35\u8868,\u6bcf\u500bfield\u5c31\u50cf\u662fSQL\u7684\u6b04\u4f4d,\u9810\u8a2d\u6703\u770b\u5230\u5f88\u591afield,\u4f8b\u5982:timestamp\u662f\u6a19\u8a18\u6642\u9593,message\u6a19\u8a18\u8a0a\u606f\u7b49.",authors:"suyuying",image:"https://github.com/suyuying.png",tags:["KQL","ELK"]},i=void 0,o={permalink:"/blog/2023/08/10/ELK/KQL-cheat-sheet",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/ELK/2023-08-10-KQL-cheat-sheet.md",source:"@site/blog/ELK/2023-08-10-KQL-cheat-sheet.md",title:"ELK KQL\u8a9e\u6cd5\u4ecb\u7d39",description:"Elastic\u67e5\u8a62\u662f\u900f\u904e\u67d0\u500bdata view\u53bb\u67e5\u5e95\u4e0b\u7684field,\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u65e5\u8a8c(data view)\u5c31\u50cf\u4e00\u5f35\u8868,\u6bcf\u500bfield\u5c31\u50cf\u662fSQL\u7684\u6b04\u4f4d,\u9810\u8a2d\u6703\u770b\u5230\u5f88\u591afield,\u4f8b\u5982:timestamp\u662f\u6a19\u8a18\u6642\u9593,message\u6a19\u8a18\u8a0a\u606f\u7b49.",date:"2023-08-10T00:00:00.000Z",formattedDate:"August 10, 2023",tags:[{label:"KQL",permalink:"/blog/tags/kql"},{label:"ELK",permalink:"/blog/tags/elk"}],readingTime:4.49,hasTruncateMarker:!1,authors:[{name:"zaxro",title:"When you\u2019re green, you grow. When you\u2019re ripe, you rot",url:"https://github.com/suyuying",imageURL:"https://github.com/suyuying.png",key:"suyuying"}],frontMatter:{title:"ELK KQL\u8a9e\u6cd5\u4ecb\u7d39",description:"Elastic\u67e5\u8a62\u662f\u900f\u904e\u67d0\u500bdata view\u53bb\u67e5\u5e95\u4e0b\u7684field,\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u65e5\u8a8c(data view)\u5c31\u50cf\u4e00\u5f35\u8868,\u6bcf\u500bfield\u5c31\u50cf\u662fSQL\u7684\u6b04\u4f4d,\u9810\u8a2d\u6703\u770b\u5230\u5f88\u591afield,\u4f8b\u5982:timestamp\u662f\u6a19\u8a18\u6642\u9593,message\u6a19\u8a18\u8a0a\u606f\u7b49.",authors:"suyuying",image:"https://github.com/suyuying.png",tags:["KQL","ELK"]},prevItem:{title:"Advanced module of ansible",permalink:"/blog/2023/08/14/IaC/ansible/ansible-advanced-module"},nextItem:{title:"k8s\u95b1\u8b80\u7b46\u8a18",permalink:"/blog/2023/08/09/K8S/k8s-basic"}},s={authorsImageUrls:[void 0]},u=[{value:"\u67e5\u8a62\u4ecb\u7d39",id:"\u67e5\u8a62\u4ecb\u7d39",level:2},{value:"KQL\u8a9e\u6cd5",id:"kql\u8a9e\u6cd5",level:3},{value:"\u67e5\u8a62\u8a9e\u6cd5\u7bc4\u4f8b",id:"\u67e5\u8a62\u8a9e\u6cd5\u7bc4\u4f8b",level:3},{value:"\u9a57\u8b49",id:"\u9a57\u8b49",level:2},{value:"ELK\u5df2\u77e5\u5831\u932f",id:"elk\u5df2\u77e5\u5831\u932f",level:2}],p={toc:u},c="wrapper";function m(e){let{components:t,...r}=e;return(0,n.kt)(c,(0,l.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"\u67e5\u8a62\u4ecb\u7d39"},"\u67e5\u8a62\u4ecb\u7d39"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"ELK_query png",src:a(31201).Z,width:"580",height:"353"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"SPACES selection: \u901a\u5e38\u6703\u4f9d\u64da\u7522\u54c1\u8ddf\u74b0\u5883\u540d\u7a31\u547d\u540d,\u8acb\u4f9d\u64da\u4f60\u8981\u67e5\u8a62\u7684\u7522\u54c1\u505a\u9078\u64c7,\u4f8b\u5982:A1-UAT,B2-PROD\u7b49,\u6578\u5b571\u65b9\u6846\u5728Elastic\u7684\u8853\u8a9e\u662fspace."),(0,n.kt)("li",{parentName:"ul"},"View selection: \u9019\u908a\u662f\u4f9d\u64da\u6a21\u584a(\u61c9\u7528\u7a0b\u5f0f)\u5340\u5206,\u900f\u904e\u5f80\u4e0b\u62c9\u958b\u5217\u8868\u53bb\u9078\u64c7\u4f60\u53ef\u4ee5\u9078\u8981\u770b\u54ea\u96bb\u670d\u52d9\u7684log,\u4e5f\u53ef\u4ee5\u5728\u5c55\u958b\u5217\u8868\u4e2d\u7684\u67e5\u8a62\u6846\u76f4\u63a5search\u8a72\u670d\u52d9\u540d\u7a31,ex.xxx-api,\u6578\u5b572\u65b9\u6846\u5728Elastic\u7684\u8853\u8a9e\u662fdata view."),(0,n.kt)("li",{parentName:"ul"},"Field selection: \u5982\u679c\u9019\u908a\u7559\u7a7a,\u67e5\u8a62\u7d50\u679c\u6703\u7d66\u4f60\u6240\u6709\u7684field\u8cc7\u6599(\u4f8b\u5982hostname,\u8def\u5f91\u4f4d\u7f6e\u7b49\u7b49),\u5982\u679c\u53ea\u662f\u55ae\u7d14\u60f3\u770b\u67d0\u6b04\u4f4d,\u9019\u908a\u53ef\u4ee5\u8f38\u5165\u8a72\u6b04\u4f4d\u540d\u7a31\u7136\u5f8c\u6309\u52a0\u865f,\u9019\u6a23\u5c31\u53ea\u6703\u986f\u793a\u51fa\u9019\u500bfield\u7684\u8cc7\u6599\uff01"),(0,n.kt)("li",{parentName:"ul"},"Log\u67e5\u8a62\u5340\u57df: \u9019\u908a\u662f\u4e3b\u8981\u67e5\u8a62log\u5730\u65b9,\u900f\u904eK(kibana)QL\u8a9e\u6cd5\u53bb\u67e5\u8a62,\u9810\u8a2d\u67e5\u8a62\u6c92\u6709\u5340\u5206\u5927\u5c0f\u5beb.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"ELK_check_time png",src:a(64559).Z,width:"318",height:"72"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Select time: \u9019\u908a\u662f\u9078\u64c7\u6642\u9593,\u9810\u8a2d\u662f\u7528\u76f8\u5c0d\u6642\u9593,\u4e5f\u53ef\u4ee5\u9078\u64c7\u6642\u9593\u6bb5,ex.2023-8-8 09:00~2023-8-9 10:00."),(0,n.kt)("li",{parentName:"ul"},"Query: \u4ee5\u4e0a\u90fd\u9078\u5b9a\u5f8c,\u900f\u904e\u9019\u683c\u505a\u67e5\u8a62")),(0,n.kt)("h3",{id:"kql\u8a9e\u6cd5"},"KQL\u8a9e\u6cd5"),(0,n.kt)("p",null,"Elastic\u67e5\u8a62\u662f\u900f\u904e\u67d0\u500bdata view\u53bb\u67e5\u5e95\u4e0b\u7684field,\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u65e5\u8a8c(data view)\u5c31\u50cf\u4e00\u5f35\u8868,\u6bcf\u500bfield\u5c31\u50cf\u662fSQL\u7684\u6b04\u4f4d,\u9810\u8a2d\u6703\u770b\u5230\u5f88\u591afield,\u4f8b\u5982:timestamp\u662f\u6a19\u8a18\u6642\u9593,message\u6a19\u8a18\u8a0a\u606f\u7b49."),(0,n.kt)("h3",{id:"\u67e5\u8a62\u8a9e\u6cd5\u7bc4\u4f8b"},"\u67e5\u8a62\u8a9e\u6cd5\u7bc4\u4f8b"),(0,n.kt)("p",null,"\u67e5\u8a62\u4e0d\u5206\u5927\u5c0f\u5beb\uff01"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},'2023/08/10 08:42:50 [error] 26457#0: *404504 "/data/info/index.html" is not found (2: No such file or directory), client: 192.168.0.11, server: h5.alloha.com, request: "GET /index/index/info/ HTTP/1.0", host: "www.alloha.com", referrer: "https://www.alloha.com:443/index/index/info/"\n')),(0,n.kt)("p",null,"\u4ee5\u67e5\u8a62\u4ee5\u4e0a\u70ba\u4f8b"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u67e5\u8a62message field\u542b\u6709www\u95dc\u9375\u5b57,\u6ce8\u610fKQL\u8a9e\u6cd5\u662f\u7528\u5b8c\u5168\u5339\u914d,\u6c92\u6709\u5b8c\u5168\u5339\u914d\u5c31\u4e0d\u56de,\u5982\u679c\u53ea\u8a18\u5f97\u95dc\u9375\u5b57\u8981\u52a0*")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kql"},"message:  *www*\n")),(0,n.kt)("p",null,"\u5982\u679c\u4f60\u7684\u95dc\u9375\u5b57\u662f\u4e2d\u6587,\u5c31\u4e0d\u7528\u52a0**,\u4e0d\u7136\u4ed6\u6703\u51fa\u4e0d\u4f86"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kql"},"message:  \u8def\u7531\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u67e5\u8a62message field\u542b\u6709\u9019\u5169\u500b\u5b57\u773cinfo\u4ee5\u53canot found\u7684\u53e5\u5b50(\u7cbe\u78ba\u5339\u914d)")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kql"},'message:  info AND message: "not found"\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u67e5\u8a62message field\u542b\u6709\u9019\u5169\u500b\u5b57\u773cinfo\u6216not found\u7684\u53e5\u5b50(\u7cbe\u78ba\u5339\u914d)")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kql"},'message:  info OR message: "not found"\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u67e5\u8a62\u6642\u9593\u57282023-08-10\u4e5d\u9ede\u5230\u5341\u9ede\u9593\u7684log")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-kql"},'@timestamp >= "2023-08-10T09" AND @timestamp <= "2023-08-10T10"\n')),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"\u53c3\u8003\u8cc7\u6599"),(0,n.kt)("ol",{parentName:"admonition"},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://www.timroes.de/kibana-search-cheatsheet"},"Kibana Search Cheatsheet (KQL & Lucene)")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://www.elastic.co/guide/en/kibana/current/kuery-query.html"},"Kibana offical website")))),(0,n.kt)("h2",{id:"\u9a57\u8b49"},"\u9a57\u8b49"),(0,n.kt)("p",null,"\u8981\u78ba\u8a8dindex\u662f\u5426\u5efa\u7acb,\u6700\u76f4\u89c0\u53ef\u4ee5\u53bb\u770bindex\u6709\u6c92\u6709\u8dd1\u51fa\u4f86\uff01\n\u6bd4\u8f03\u6b21\u4e4b\u7684\u65b9\u6cd5,\u53bb\u770bes_log_dir\u6307\u5b9a\u7684log\u4f4d\u7f6e\u88cf\u9762\u7684",(0,n.kt)("inlineCode",{parentName:"p"},"log-cluster.log"),"\u4ed6\u9810\u8a2d\u6bcf\u5929\u6703\u58d3\u7e2e\u7576\u65e5\u7684log\u4e00\u6b21. "),(0,n.kt)("p",null,"\u5982\u679c\u6c92\u767c\u73fe\u6709\u5efa\u7acb,\u90a3\u5c31\u8981\u6392\u67e5\u4e86,\u6211\u4e00\u822c\u90fd\u6703\u505a\u5e7e\u500b\u65b9\u5411\u6392\u67e5"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u6aa2\u67e5filebeat\u4e4b\u985e\u8f49\u767c\u65e5\u8a8c\u7684\u670d\u52d9,\u4ed6\u5c0delastic\u7684\u7db2\u8def\u6709\u6c92\u6709\u901a"),(0,n.kt)("li",{parentName:"ol"},"\u6aa2\u67e5filebeat\u5728/var/log/filebeat.log\u6709\u6c92\u6709\u5831\u932f,/var/lib/filebeat\u9019\u908a\u7684\u6307\u91dd\u6709\u6c92\u6709\u52d5(\u4ed6\u539f\u7406\u662f\u5b9a\u6642\u5075\u6e2c\u6a94\u6848\u7136\u5f8c\u7528\u6307\u91dd\u65b9\u5f0f\u6a19\u793a\u4ed6\u76ee\u524d\u8b80\u7684\u4f4d\u7f6e,\u9019\u6a23\u624d\u4e0d\u6703\u91cd\u8907\u51fa\u53bb),\u5982\u679c\u767c\u73fe\u6307\u91dd\u6839\u672c\u6c92\u52d5\u90a3\u4e00\u5b9a\u662f\u4f60\u65e5\u8a8c\u8def\u5f91\u932f\u4e86\uff01"),(0,n.kt)("li",{parentName:"ol"},"\u628a\u4ee5\u4e0a\u6253\u901a,\u9084\u662f\u639b\u7684\u5c31\u8981\u53bb\u78ba\u8a8d\u662f\u4e0d\u662felastich\u554f\u984c")),(0,n.kt)("h2",{id:"elk\u5df2\u77e5\u5831\u932f"},"ELK\u5df2\u77e5\u5831\u932f"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"shard\u7206\u91cf\u5831\u932f\u5982\u4e0b,\u9810\u8a2d\u6bcf\u500bnode\u4e0a\u9650\u662f\u5efa\u7acb1000\u500bshard,\u7206\u4e86\u8981\u505a\u8abf\u6574(\u9019\u908a\u5148\u4e0d\u8a0e\u8ad6\u8d85\u904e1000\u662f\u5426\u5408\u7406)")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-text"},'[ERROR][o.e.x.i.IndexLifecycleRunner] [elastic-1] policy [filebeat] for index [.xxxxxx] failed on step [{"phase":"hot","action":"rollover","name":"attempt-rollover"}]. Moving to ERROR step\norg.elasticsearch.common.ValidationException: Validation Failed: 1: this action would add [2] shards, but this cluster currently has [2999]/[3000] maximum normal shards open;\n')),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/8ea97bd0f037"},"\u89e3\u6cd5\u5c31\u662f\u53bb\u8abf\u6574\u6bcf\u500bnode\u4e0a\u9650shard")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u8a18\u61b6\u9ad4\u4e0d\u8db3\u5831\u932f,\u8abf\u6574",(0,n.kt)("inlineCode",{parentName:"li"},"jvm.options"),"\u4e2d\u7684\u8a18\u61b6\u9ad4\u91cf\uff01\u4e00\u822c\u5efa\u8b70\u662f\u7528\u4e8c\u5206\u4e4b\u4e00\u8a18\u61b6\u9ad4\uff01")))}m.isMDXComponent=!0},64559:(e,t,a)=>{a.d(t,{Z:()=>l});const l=a.p+"assets/images/ELK_check_time-936057517b5c5b81090814ad72ec80ba.png"},31201:(e,t,a)=>{a.d(t,{Z:()=>l});const l=a.p+"assets/images/ELK_query-d9e815ef6a62481edaff9d7179fad6e5.png"}}]);